#!/usr/bin/env bash
# configures a brand new Ubuntu machine
# Ignore SC2154 for shellcheck
# shellcheck disable=SC2154

# Updates the package list
sudo apt-get update

# Installs Nginx
sudo apt-get install -y nginx

# Gets the hostname of the current machine
HOSTNAME=$(hostname)

# Backup the default Nginx configuration file
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# Modify the default server block to add the custom header
sudo sed -i '/server_name _;/a \    add_header X-Served-By '"$HOSTNAME"';' /etc/nginx/sites-available/default

# Restart Nginx to apply the changes
sudo systemctl restart nginx

# Check the Nginx status
NGINX_STATUS=$(sudo systemctl is-active nginx)
if [ "$NGINX_STATUS" == "active" ]; then
    echo "Nginx has been configured with a custom header 'X-Served-By: $HOSTNAME'"
else
    echo "Failed to configure Nginx"
fi
